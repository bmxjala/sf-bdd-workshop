machine:
  services:
    - docker
    - mongodb
  php:
    version: 5.6.14
dependencies:
  pre:
    - sudo service mongodb stop
    - printf "\n" | pecl install mongo
    - cd symfony-bdd-workshop && composer install -n
  override:
    - sudo pip install -U docker-compose==1.3.3
    - docker-compose up -d

test:
  override:
    - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' sfbddworkshop_php_1)" -- bash -c "cd /var/www/symfony-bdd-workshop && composer install -n"
    - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' sfbddworkshop_php_1)" -- bash -c "cd /var/www/symfony-bdd-workshop && ./bin/behat"
    - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' sfbddworkshop_php_1)" -- bash -c "cd /var/www/symfony-bdd-workshop && ./bin/phpspec run"

deployment:
  FEATURE:
    branch: develop
    commands:
      - echo 'no deployment now'
